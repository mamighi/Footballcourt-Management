<!DOCTYPE HTML>
<html>
	<head>
		<title>Booking</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/radio.css" />

		
	</head>
	<body class="subpage">

		<!-- Header -->
			<header id="header">
				<div class="logo"><a href="index.html"> <span>Booking</span></a></div>
				<a href="#menu">Menu</a>
			</header>

		<!-- Nav -->
			<nav id="menu">
				<ul class="links">
<li><a href="bookcourt.html">Book Court</a></li>
					<li><a href="editFu.html">Profile</a></li>
					<li><a href="historyfu.html">Book History</a></li>
					<li><a href="index.php">Sign Out</a></li>
				</ul>
			</nav>

		<!-- Main -->
			<div id="main">

				<!-- Section -->
					<section class="wrapper">
						<div class="inner">
						<header class="align-center">
								<h1>Booking</h1>
							</header>
						<div class="row uniform">
							<div class="6u 12u$(xsmall)">
							Futsal Court Name:
							<input type="text" name="name" id="name" value="" placeholder="Name" readonly>
							</div>
							<div class="6u 12u$(xsmall)">
							State:
							<input type="text" name="name" id="state" value="" placeholder="state" readonly>
							</div>
							<div class="6u 12u$(xsmall)">
							Address:
							<input type="text" name="name" id="Address" value="" placeholder="Address" readonly>
							</div>
							<div class="6u 12u$(xsmall)">
							Contact Number:
							<input type="text" name="name" id="cno" value="" placeholder="Contact Number" readonly>
							</div>
							<div class="6u 12u$(xsmall)">
							Student Price:
							<input type="text" name="name" id="sp" value="" placeholder="" readonly>
							Peak Hour Price:
							<input type="text" name="name" id="pp" value="" placeholder="" readonly>
							Not Peak Hour Price:
							<input type="text" name="name" id="np" value="" placeholder="" readonly>
							Booking Date:</br>
							 <input type="date" id="datePicker" name="bday" style="width:100%" onchange="handler(event);">
							 </div>
							<div class="6u 12u$(xsmall)">
							<span class="image left"><img id ='img' src="" alt=""></span>
							</div>
							<div class="6u 12u$(small)">
							</div>
							<div class="6u 12u$(small)">
							Court Available Times:
							</br>
					<input type="checkbox" id="7" name="checkbox-btns">
								<label class="btn" for="7" id="l7">7AM-8AM </label>
								<input type="checkbox" id="8" name="checkbox-btns">
								<label class="btn" for="8" id="l8">8AM-9AM </label>
								<input type="checkbox" id="9" name="checkbox-btns">
								<label class="btn" for="9" id="l9">9AM-10AM </label>
								<input type="checkbox" id="10" name="checkbox-btns">
								<label class="btn" for="10" id="l10">10AM-11AM </label>
								<input type="checkbox" id="11" name="checkbox-btns">
								<label class="btn" for="11" id="l11">11AM-12PM </label>
								<input type="checkbox" id="12" name="checkbox-btns">
								<label class="btn" for="12" id="l12">12PM-1PM </label>
								<input type="checkbox" id="13" name="checkbox-btns">
								<label class="btn" for="13" id="l13">1PM-2PM </label>
								<input type="checkbox" id="14" name="checkbox-btns">
								<label class="btn" for="14" id="l14">2PM-3PM </label>
								<input type="checkbox" id="15" name="checkbox-btns">
								<label class="btn" for="15" id="l15">3PM-4PM </label>
								<input type="checkbox" id="16" name="checkbox-btns">
								<label class="btn" for="16" id="l16">4PM-5PM </label>
								<input type="checkbox" id="17" name="checkbox-btns">
								<label class="btn" for="17" id="l17">5PM-6PM </label>
								<input type="checkbox" id="18" name="checkbox-btns">
								<label class="btn" for="18" id="l18">6PM-7PM </label>
								<input type="checkbox" id="19" name="checkbox-btns">
								<label class="btn" for="19" id="l19">7PM-8PM </label>
								<input type="checkbox" id="20" name="checkbox-btns">
								<label class="btn" for="20" id="l20">8PM-9PM </label>
								<input type="checkbox" id="21" name="checkbox-btns">
								<label class="btn" for="21" id="l21">9PM-10PM </label>
								<input type="checkbox" id="22" name="checkbox-btns">
								<label class="btn" for="22" id="l22">10PM-11PM </label>
							</div>	
						</div>
						</br>
						<button id="confirm" class="button fit" style="width:250px; background:green">Confirm</button>
						</div>
						
						
					</section>
					
			</div>
					

			</div>


		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
	<script>
		var queryString = decodeURIComponent(window.location.search);
		function getParameterByName(name, url) {
			if (!url) url = window.location.href;
			name = name.replace(/[\[\]]/g, '\\$&');
			var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
				results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			return decodeURIComponent(results[2].replace(/\+/g, ' '));
		}
		queryString = queryString.substring(1);
		var id_ = getParameterByName('id');
		var no = getParameterByName('no');
		var today = new Date();
		var topen=0;
		var tclose=0;
		var pp=0;
		var npp=0;
		document.getElementById('datePicker').value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
		document.getElementById('confirm').onclick=function(){
			var selectedHours="";
			var isSelected=false;
			var inputs = document.getElementsByName("checkbox-btns");
			for(var i = 0; i < inputs.length; i++) {
				if(inputs[i].checked)
				{
					selectedHours+=inputs[i].id+",";
					isSelected=true;
				}
			}
			if(!isSelected)
			{
				alert("Please choose a time");
				return;
			}
			var query = "?cid="+id_+"&date="+document.getElementById('datePicker').value+"&hours="+selectedHours+"&pp="+pp+"&npp="+npp+"&no="+no;;
			window.location.href = "bookingConfirmation.html" + query;
		}
		
		$.ajax({
				type:"post",
				url:"booking.php",
				data: 
				{  
				   'action' :'getdet',
				   'id' : id_
				},
				cache:false,
				success: function (html) 
				{
					 var jsonData = JSON.parse(html);
					 for(x in jsonData)
					 {
						if(jsonData[x].ID==id_)
						{
							document.getElementById('name').value=jsonData[x].Name +" / Court "+no;
							document.getElementById('state').value=jsonData[x].state;
							document.getElementById('Address').value=jsonData[x].Address;
							document.getElementById('cno').value=jsonData[x].cno;
							document.getElementById('sp').value="RM"+jsonData[x].sprice;
							document.getElementById('pp').value="RM"+jsonData[x].pprice;
							pp=jsonData[x].pprice;
							document.getElementById('np').value="RM"+jsonData[x].npprice;
							npp=jsonData[x].npprice;
							topen=jsonData[x].open;
							tclose=jsonData[x].close;
							var img=jsonData[x].image;
							if(img==null || img.length<10)
							{
								img='images/banner.jpg';
							}
							document.getElementById('img').src=img;
							loadDateDetails(document.getElementById('datePicker').value);
						}
					 }
				}
			});
			
			function handler(e){
			  loadDateDetails(e.target.value);
			}
			function loadDateDetails(date)
			{
				var inputs = document.getElementsByName("checkbox-btns");
				for(var i = 0; i < inputs.length; i++) {
					var intId=parseInt(inputs[i].id);
					
					if(intId<parseInt(topen) || intId>=parseInt(tclose))
					{
					
						inputs[i].disabled  = true; 
						var labelId="l"+inputs[i].id;
						document.getElementById(labelId).disabled =true;
					}
					else
						inputs[i].disabled  = false; 
					inputs[i].checked=false;
				}
				$.ajax({
					type:"post",
					url:"booking.php",
					data: 
					{  
					   'action' :'getDetails',
					   'cid' : id_,
					   'date': date
					},
					cache:false,
					success: function (html) 
					{
					//alert(html);
						var jsonData = JSON.parse(html);
						
						for(x in jsonData)
						{
							var time=jsonData[x].time;
							var lId=time;
							
							document.getElementById(lId).disabled =true;
							var labelId="l"+lId;
						document.getElementById(labelId).disabled =true;
						
						}
					}
				});
				
			}
	</script>
</html>